# Feature Specification: タスク管理アプリ（ユーザ認証付き）

**Feature Branch**: `001-task-manager-auth`
**Created**: 2026-01-15
**Status**: Draft
**Input**: User description: "ユーザログイン機能があるタスク管理アプリを構築します。認証は username と password による簡易的なものです。タスクは「タスク名」と「完了したか否か」だけが管理できればよいです。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - ユーザー登録とログイン (Priority: P1)

ユーザーは新しいアカウントを作成し、username と password でログインできる。ログインすることで自分のタスクにアクセスできるようになる。

**Why this priority**: 認証はアプリの基盤機能であり、タスク管理機能を利用するための前提条件となる。これがなければ他の機能は成り立たない。

**Independent Test**: username と password を入力してアカウント作成→ログイン→ログアウトの一連の流れが完了できることを確認する。タスク機能がなくても、認証の成功/失敗を確認できる。

**Acceptance Scenarios**:

1. **Given** ユーザーがアカウントを持っていない状態, **When** 新しい username と password を入力して登録する, **Then** アカウントが作成されログイン状態になる
2. **Given** 登録済みのアカウントがある状態, **When** 正しい username と password でログインする, **Then** ログインに成功しタスク一覧画面にアクセスできる
3. **Given** ログイン状態, **When** ログアウトする, **Then** ログアウトされログイン画面に戻る
4. **Given** 登録済みのアカウントがある状態, **When** 間違った password でログインを試みる, **Then** ログインに失敗しエラーメッセージが表示される

---

### User Story 2 - タスクの作成と一覧表示 (Priority: P2)

ログインしたユーザーは新しいタスクを作成し、自分のタスク一覧を確認できる。各タスクにはタスク名と完了状態が表示される。

**Why this priority**: タスク管理の基本機能。ユーザーがタスクを追加し、現在の状況を把握できるようになる。

**Independent Test**: ログイン後、タスクを複数作成し、一覧に表示されることを確認する。認証機能があれば独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** ログイン済みでタスクがない状態, **When** タスク名を入力して新規タスクを作成する, **Then** タスクが一覧に追加され未完了状態で表示される
2. **Given** ログイン済みでタスクが複数ある状態, **When** タスク一覧を表示する, **Then** 自分のタスクがすべて表示される（他ユーザーのタスクは表示されない）
3. **Given** ログイン済みの状態, **When** 空のタスク名で作成を試みる, **Then** エラーメッセージが表示されタスクは作成されない

---

### User Story 3 - タスクの完了状態の切り替え (Priority: P3)

ユーザーはタスクの完了状態を切り替えることができる。完了したタスクは完了済みとしてマークされる。

**Why this priority**: タスク管理の核心機能だが、タスク作成と一覧表示が先に必要。

**Independent Test**: 既存のタスクの完了状態を未完了→完了→未完了と切り替え、状態が正しく保持されることを確認する。

**Acceptance Scenarios**:

1. **Given** 未完了のタスクがある状態, **When** そのタスクを完了としてマークする, **Then** タスクが完了状態に変わる
2. **Given** 完了済みのタスクがある状態, **When** そのタスクを未完了に戻す, **Then** タスクが未完了状態に変わる

---

### Edge Cases

- ユーザー名が既に登録されている場合、適切なエラーメッセージを表示する
- セッションが切れた状態でタスク操作を行った場合、ログイン画面にリダイレクトする
- タスク名の最大文字数を超えた場合、エラーメッセージを表示する

## Requirements *(mandatory)*

### Functional Requirements

**認証関連**:
- **FR-001**: システムは username と password によるユーザー登録機能を提供する
- **FR-002**: システムは username と password によるログイン機能を提供する
- **FR-003**: システムはログアウト機能を提供する
- **FR-004**: システムは認証されていないユーザーのタスク操作を拒否する
- **FR-005**: システムは登録済みの username での重複登録を拒否する

**タスク管理関連**:
- **FR-006**: ユーザーは新しいタスクを作成できる（タスク名は必須）
- **FR-007**: ユーザーは自分のタスク一覧を表示できる
- **FR-008**: ユーザーはタスクの完了状態を切り替えできる
- **FR-009**: ユーザーは他のユーザーのタスクにアクセスできない

**データ検証**:
- **FR-010**: システムは空のタスク名を拒否する
- **FR-011**: システムは空の username または password での登録を拒否する

### Key Entities

- **User**: アプリケーションのユーザー。username（一意）と password を持つ。複数のタスクを所有できる。
- **Task**: ユーザーが管理するタスク。タスク名（必須）と完了状態（真偽値、デフォルトは未完了）を持つ。必ず1人のユーザーに紐づく。

### Assumptions

- username は大文字小文字を区別する
- password は平文で保存せず、ハッシュ化して保存する（セキュリティ基本要件）
- タスク名の最大文字数は200文字とする
- username の最大文字数は50文字とする
- タスクの並び順は作成日時の降順（新しいものが上）とする
- ログインセッションは24時間有効とする

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーは30秒以内にアカウント登録を完了できる
- **SC-002**: ユーザーは10秒以内にログインを完了できる
- **SC-003**: ユーザーは5秒以内に新しいタスクを作成できる
- **SC-004**: タスク一覧は1秒以内に表示される（100件以下のタスク）
- **SC-005**: 完了状態の切り替えは即座に反映される（体感0.5秒以内）
- **SC-006**: 認証エラー時は3秒以内にエラーメッセージが表示される
